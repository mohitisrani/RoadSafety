<!DOCTYPE html>
 <head>
    <title>Road Safety</title>
    <link rel="stylesheet" type="text/css" href="blog.css">

     <!--[if IE]>
<script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->

  </head>

<body>

    <header>
      <h1>Data Stats</h1>
    </header>

    
    <% if params[:pageQ] == nil %>
        <% pageQ = Hash.new(false) %>
        <% pageQ[:qs2] = -1 %>
        <% params[:pageQ] = pageQ.to_s %>

    <% end %>


    <div id="container">

      <article>
        <section class="post-head">
            <h2>Queries</h2>
  <!--         <small>            
            Posted on <time datetime="2018-04-12">April 12th, 2018</time>.
          </small> -->
        </section>

        <section class="post-body">
          <p>
            <OL>

            <% pageQOnClick  = eval(params[:pageQ]).clone %>
            <% pageQOnClick[:qs1] = true %>
            <LI><%= link_to "Calculate the total number of Accidents", url_for(controller: :queries, action: :index, :pageQ => pageQOnClick.to_s) %>
                <% pageQ_  = eval(params[:pageQ]) %>
                <% if pageQ_[:qs1] ==true %>
                    <section class="qResult">
                        <p>
                            <%= ActiveRecord::Base.connection.exec_query("SELECT COUNT(*) FROM ACCIDENTS")[0]["count(*)"] %>
                        </p>
                    </section>
                <% end %>
                
            <% pageQOnClick  = eval(params[:pageQ]).clone %>
            <% pageQOnClick[:qs2] =  0%>
            <LI><%= link_to "Show first 10 tuples", url_for(controller: :queries, action: :index, :pageQ => pageQOnClick.to_s) %>
                <% pageQ_  = eval(params[:pageQ]) %>
                <% if pageQ_[:qs2] != -1 %>
                    <section class="qResult">
                        <p> 
                            <% qR = ActiveRecord::Base.connection.exec_query("SELECT a from (select accident_index a, rownum r FROM ACCIDENTS) where r >= #{pageQ_[:qs2]*10+1} AND r <= #{pageQ_[:qs2]*10+10}"); %>
                                <OL start = <%= pageQ_[:qs2]*10+1%> >
                                    <% for q in 1..qR.rows.length %>
                                         <LI> <%=  qR.rows[q-1][0]   %>
                                    <% end %>
                                </OL>
                                <small>
                                    <% pageQOnClick  = eval(params[:pageQ]).clone %>
                                    <% pageQOnClick[:qs2] =  pageQOnClick[:qs2] + 1%>
                                    <%= link_to "NEXT 10 tuples", url_for(controller: :queries, action: :index, :pageQ => pageQOnClick.to_s) %>
                                </small>
                        </p>
                    </section>
                <% end %>

            <% pageQOnClick  = eval(params[:pageQ]).clone %>
            <% pageQOnClick[:qs3] = true %>
            <LI><%= link_to "Total number of Casualties", url_for(controller: :queries, action: :index, :pageQ => pageQOnClick.to_s) %>
                <% pageQ_  = eval(params[:pageQ]) %>
                <% if pageQ_[:qs3] ==true %>
                     <section class="qResult">
                            <p>
                                <%= ActiveRecord::Base.connection.exec_query("SELECT COUNT(*) FROM casualties")[0]["count(*)"] %>
                            </p>
                    </section>
                <% end %>

            <% pageQOnClick  = eval(params[:pageQ]).clone %>
            <% pageQOnClick[:qs4] = true %>
            <LI><%= link_to "Total number of Vehicles involved", url_for(controller: :queries, action: :index, :pageQ => pageQOnClick.to_s) %>
                 <% pageQ_  = eval(params[:pageQ]) %>
                 <% if pageQ_[:qs4] ==true %>
                     <section class="qResult">
                            <p>
                                <%= ActiveRecord::Base.connection.exec_query("SELECT COUNT(*) FROM vehicles")[0]["count(*)"] %>
                            </p>
                    </section>
                <% end %>

            <% pageQOnClick  = eval(params[:pageQ]).clone %>
            <% pageQOnClick[:qs5] = true %>
            <LI><%= link_to "Average age of Vehicle", url_for(controller: :queries, action: :index, :pageQ => pageQOnClick.to_s) %>
                 <% pageQ_  = eval(params[:pageQ]) %>
                 <% if pageQ_[:qs5] ==true %>
                     <section class="qResult">
                            <p>
                                <%= ActiveRecord::Base.connection.exec_query("SELECT AVG(age_of_vehicle) as av FROM vehicles")[0]["av"].round(2) %>
                            </p>
                    </section>
                <% end %>

            </OL>
          </p>

        </section>

        <section class="post-foot">
          <p>Filed under general</p>
          <!-- <p>Written by Mohit</p> -->
        </section>
      </article>


      

    </div> <!-- #container -->

    <footer>
      <p>&copy;2018 &bull; Group29DBMS</p>
    </footer>










</body>
</html>
